

repositories {
    mavenCentral()
    maven {
        url "http://raw.githubusercontent.com/pjreiniger/maven_repo/master/"
    }
}

configurations {
    wpilibjJni
}

dependencies {
    wpilibjJni 'edu.wpi.first.wpilibj:wpilibj-jniShared:' + getWpilibjVersion() + ':all'
}

task extractWpilibjJniShared(type: Copy) {
    def os_name = org.gradle.internal.os.OperatingSystem.current().getFamilyName();

    destinationDir = file("$rootDir/build/dependencies/wpilibj-jniShared")
	configurations.wpilibjJni.each {
	    from(zipTree(it)) {
	        into os_name + "x86-64/"
	    }
    }
}


task captureWpiLibraries(type: Jar, dependsOn: extractWpilibjJniShared) {

    def os_name = org.gradle.internal.os.OperatingSystem.current().getFamilyName();
    def output_path = os_name + "/x86-64/"
    
    destinationDir = file("$rootDir/build/wpi_libraries")
    classifier = "wpi_native-" + os_name;
    
    def libraries = ["wpilibj-jniShared",
                     "wpiutil-cpp",
                     "halsim-adx_gyro_accelerometer",
                     "hal"]
                 
 	libraries.each{
 	    def full_path = "$rootDir/build/dependencies/" + it + "/" + os_name + "x86-64/" + os_name + "/x86-64/shared"
 	    println full_path
 	    from(full_path) {
            into output_path
            include "*.dll"
            include "*.so"
        }
 	}
}
